<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Shop</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />

    <link href="~/lib/font-awesome/css/all.css" rel="stylesheet" />

    <link href="~/lib/owl.carousel/owl.carousel.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/style.css">
    <link rel="stylesheet" href="~/css/list_product.css">

    <link rel="stylesheet" href="~/css/custom-select.css">
    <link rel="stylesheet" href="~/css/single.css">
    <!--============================Animation========================================-->
    <link rel="stylesheet" type="text/css" href="~/css/animation.css">
    <!--============================Animation========================================-->
    @RenderSection("head", required: false)
</head>

<body>
    <header>
        <div id="header-top" class=" hidden-sm-down">
            <div class="container">
                <div class="languages">
                    <ul class="nav">
                        <li class="lan custom-select">
                            <select>
                                <option>Tiếng việt</option>
                                <option>English</option>
                            </select>
                        </li>
                        <li class="money custom-select">
                            <select>
                                <option>VNĐ</option>
                                <option>USD</option>
                            </select>
                        </li>
                        <li>
                            <div class="textwidget">
                                <p>
                                    <i class="fa fa-volume-control-phone" aria-hidden="true"></i> +84 987 325 600
                                </p>
                            </div>

                        </li>
                    </ul>
                </div>

                <div class="top-link">
                    <ul class="nav">
                        <li><a href="~/html/trackorder.html">Track order</a></li>
                        <li><a href="#">Contact us</a></li>
                        <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-envelope-o" aria-hidden="true"></i></a></li>
                    </ul>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="mobile-nav">
            <div class="mobile-logo">
                <a asp-controller="Home" asp-action="Index"><img src="~/img/system/logo.png"></a>
            </div>
            <div class="mobile-group-btn">
                <ul>
                    <li>
                        <a href="" class="js-show-modal-search"><i class="fa fa-search" aria-hidden="true"></i></a>
                    </li>
                    <li class="wishlist-icon">
                        <a href="~/html/wishlist.html"><i class="fal fa-heart"></i> <span class="wishlist-count">2</span></a>
                        <input type="number" id="wishlist-count-input-mb" name="wishlist-count">
                    </li>
                    <li class="cart-icon">
                        <a href="~/html/cart.html"><i class="fa fa-shopping-basket" aria-hidden="true"></i> <span class="cart-count">0</span></a>
                        <input type="number" id="cart-count-input-mb" name="cart-count">
                    </li>
                    <li class="open-close">
                        <i class="fa fa-bars" aria-hidden="true"></i>
                    </li>
                </ul>
            </div>
        </div>
        <div id="header-mid">
            <div class="container">
                <a href="" class="close-menu close-open"><i class="fas fa-window-close"></i></a>
                <div class="row">
                    <div class="col-8">
                        <div class="logo">
                            <a asp-controller="Home" asp-action="Index" class="navbar-brand"><img src="~/img/system/logo.png"></a>
                        </div>
                        <div class="menu-main">
                            <ul class="nav">
                                <li class="nav-item"><a class="nav-link active" asp-controller="Home" asp-action="Index">Home</a></li>
                                <li class="nav-item"><a class="nav-link active" asp-controller="Product" asp-action="Index">Product</a></li>
                                <li class="nav-item"><a class="nav-link active" asp-controller="Blog" asp-action="Index">Blog</a></li>
                                <li class="nav-item"><a class="nav-link active" asp-controller="Contact" asp-action="Index">Contact</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="menu-login">
                            <ul class="nav">
                                <li>
                                    <a href="javascript:void(0)" class="js-show-modal-search"><i class="fa fa-search" aria-hidden="true"></i></a>
                                </li>
                                <!--<li class="login-icon">
                                    <a href="~/html/login.html">LOG IN / SIGN UP</a>
                                    <div class="login-content content-dropdown">
                                        <form>
                                            <label>Tên đăng nhập</label>
                                            <input type="text" name="username" autocomplete="off">
                                            <label>Mật khẩu</label>
                                            <input type="password" name="password" autocomplete="off">
                                            <div class="note">
                                                <span><i class="fa fa-square-o" aria-hidden="true"></i> ghi nhớ</span>
                                                <a href="" style="float: right;">Quên mật khẩu</a>
                                            </div>
                                            <button class="btn btn-black">Đăng nhập</button>
                                            <div class="note">
                                                <span>Khách hàng mới</span>
                                                <a href="" style="padding-left: 10px;">Đăng ký</a>
                                            </div>
                                        </form>
                                    </div>
                                </li>
                                <li class="wishlist-icon">
                                    <a href="~/html/wishlist.html"><i class="fal fa-heart"></i> <span class="wishlist-count">2</span></a>
                                    <input type="number" id="wishlist-count-input" name="wishlist-count" value="2">
                                    <div class="wishlist-content content-dropdown">
                                        <ul class="scroll-js scroll-y">-->
                                <!-- Danh sách sản phẩm yêu thích -->
                                <!--</ul>
                                        <hr>
                                        <a href="~/html/cart.html" class="btn btn-black">Xem danh sách</a>
                                    </div>
                                </li>-->
                                <li id="wishlist-icon">
                                    <a asp-controller="cart" asp-action="wishlist">
                                        <i class="fal fa-heart"></i>
                                        <span class="wishlist-count"></span>
                                    </a>
                                    <input type="number" id="wishlist-count-input-mb" name="wishlist-count">
                                </li>
                                <li>@await Html.PartialAsync("_CartPartial")</li>
                            </ul>
                        </div>
                    </div>
                </div>
                @*Serch Modal*@
                <div class="modal-search-header js-hide-modal-search  ">
                    <div class="container-search-header">
                        <button class="btn-hide-modal-search js-hide-modal-search">
                            <i class="fa fa-window-close-o" aria-hidden="true"></i>
                        </button>

                        <form class="wrap-search-header">
                            <button class="trans-04">
                                <i class="fa fa-search"></i>
                            </button>
                            <input type="text" name="search" placeholder="Tìm kiếm...">
                        </form>
                    </div>
                </div>


            </div>
        </div>
        <div id="header-bottom">
            <p>Miễn phí giao hàng nội thành
            <p>
        </div>
        <div class="clearfix"></div>
    </header>
    <div class="container">
        <main>
            @RenderBody()
        </main>
    </div>

    <footer>
        <div class="footer-midde">
            <div class="container">
                <div class="row">
                    <div class="col-md-3 col-sm-6 help">
                        <h3>Trợ giúp</h3>
                        <ul class="">
                            <li><a href="#">Thanh toán</a></li>
                            <li><a href="#">Mua hàng</a></li>
                            <li><a href="#">Đổi trả</a></li>
                            <li><a href="#">Nạp tiền</a></li>
                        </ul>
                    </div>
                    <div class="col-md-3 col-sm-6 location search">
                        <h3>Vị trí</h3>
                        <ul class="nav">
                            <li>Tìm cửa hàng <br><a href="#" class="btn btn-gray"><i class="fa fa-map-marker" aria-hidden="true"></i></a></li>
                            <li>Tìm đơn hàng <br><a href="#" class="btn btn-gray"><i class="fa fa-id-card" aria-hidden="true"></i></a></li>
                        </ul>
                    </div>
                    <div class="col-md-3 col-sm-6 application">
                        <h3>Tải ứng dụng</h3>
                        <ul>
                            <li><a href="#" class="btn btn-black"><i class="fa fa-apple" aria-hidden="true"></i><span><small>Download on the</small> App Store</span></a></li>
                            <li><a href="#" class="btn btn-gray"><i class="fa fa-android" aria-hidden="true"></i><span><small>Download it from </small>Play Store</span></a></li>
                        </ul>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <h3>Fan</h3>
                        <ul class="nav icon">
                            <li>
                                <a href="#"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>
                            </li>
                            <li><a href="#"><i class="fa fa-google-plus" aria-hidden="true"></i></a></li>
                            <li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                        </ul>
                    </div>

                    <div class="clearfixr"></div>
                </div>
            </div>
        </div>
        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <p>Ⓒ Created by Toan</p>
                    </div>
                    <div class="col-md-6">
                        <div class="cards text-right">
                            <img src="~/img/cards.png" alt="Credit Cards" style="width: 187px">
                        </div>
                    </div>

                    <div class="clearfix"></div>
                </div>
            </div>
        </div>

    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/owl.carousel/owl.carousel.js"></script>
    <script src="~/js/custom-select.js"></script>
    @*<script src="~/js/main.js"></script>*@


    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" integrity="sha256-xNjb53/rY+WmG+4L6tTl9m6PpqknWZvRt0rO1SRnJzw=" crossorigin="anonymous"></script>
    @*<script src="~/js/addProduct.js"></script>*@
<script>
            $(document).ready(function () {
    addtocart();
    addtowishlist();
    function addtocart() {
    $.ajax({
    type: 'GET',
    url: '@Url.ActionLink("GetListProduct", "Cart")',
    success: function (result) {
    var row = ``;
    if (result != null && result != '') {
    var cart = result;

    } else {
    $("#cartBody").html('Giỏ hàng trống');
    $(".total").find(".total-cart").html('');
    //$(".cart-content").html('Giỏ hàng trống');
    $(".cart-count").html(`${0}`);
    return;

    }
    var count = 0;

    var totalPriceSales = function () {

    let totalPriceSale = 0;
    for (var i = 0; i < cart.length; i++) {

    if (cart[i].Sale != "") {
    totalPriceSale += parseFloat(cart[i].product.sale * cart[i].quantity);
    } else {
    totalPriceSale += parseFloat(cart[i].product.price * cart[i].quantity);
    }
    }
    return totalPriceSale;
    };

    var totalPrices = function () {
    let totalPrice = 0;

    for (var i = 0; i < cart.length; i++) {
    totalPrice += parseFloat(cart[i].product.price * cart[i].quantity);

    }
    return totalPrice;
    };
    var Total = 0;
    if (totalPriceSales() > 0) {
    Total = "$" + totalPrices() + "₫" + "-" + "<del style='color: #888'>" + totalPriceSales() + " ₫" + "</del>"
    } else {
    Total = "$" + totalPrices() + "₫"
    }
    $(".total").find(".total-cart").html(Total);
    for (var i = 0; i < cart.length; i++) {
    row += `<li class="item-cart-1" data-id=${cart[i].product.id}>
        <div class="img-left">
            <a href="/chi-tiet/${cart[i].product.slug}">
                <img src="https://localhost:5002/user-content/${cart[i].product.thumbnail.fileName}" style="width: 100%">
            </a>
        </div>
        <div class="meta-right">
            <a href="javascript:void(0)" class="remove-item">
                <i class="fa fa-times" aria-hidden="true"></i>
            </a>
            <a href="/chi-tiet/${cart[i].product.slug}" class="title cart-title">${cart[i].product.title}</a>
            <p>
                <span class="price">$${cart[i].product.price} ₫</span>`
                if (cart[i].product.sale != "" && cart[i].product.sale != null) {
                row += `- <span class="sale">${cart[i].product.sale} ₫</span>
            </p> `
            }
            row += `<div>
                <p class="quantity">
                    <span class="name">Số lượng: </span>
                    <span>
                        <div class="qty mt-1">
                            <span class="minus bg-dark">-</span>
                            <input type="number" class="count" name="qty" value="${cart[i].quantity}" min="1" max="10" data-val="${cart[i].quantity}">
                            <span class="plus bg-dark">+</span>
                        </div>
                    </span>
                </p>
            </div>

        </div>
    </li>`;
    count += cart[i].quantity
    }
    $("#cartBody").html(row);
    $(".cart-count").html(`${count}`);
    }

    })
    };
    $(document).on('click', '.js-add-cart', function (event) {
    event.preventDefault();
    let parent = $(this).parents('.product-item');
    let productid = parseInt(parent.find('.product-grid6').attr('data-id'));

    $.ajax({
    type: 'POST',
    url: '@Url.ActionLink("AddToCart", "Cart")',
    data: {
    productid: productid,

    },
    success: function (result) {
    addtocart();
    //window.location.href = '@Url.ActionLink("cart", "cart")';
    }
    })

    });
    $(document).on('click', '.add-cart', function (event) {
    event.preventDefault();
    let parent = $(this).parents('.product-details');
    let productid = parseInt(parent.find('.product-details-item').attr('data-id'));
    let quantity = parseInt(parent.find('.num-product').val());
    $.ajax({
    type: 'POST',
    url: '@Url.ActionLink("AddToCart", "Cart")',
    data: {
    productid: productid,
    quantity: quantity
    },
    success: function (result) {
    addtocart();
    //window.location.href = '@Url.ActionLink("cart", "cart")';
    }
    })

    });
    $(document).on('click', '.checkout-cart', function (event) {
    event.preventDefault();
    let parent = $(this).parents('.product-details');
    let productid = parseInt(parent.find('.product-details-item').attr('data-id'));
    let quantity = parseInt(parent.find('.num-product').val());
    $.ajax({
    type: 'POST',
    url: '@Url.ActionLink("AddToCart", "Cart")',
    data: {
    productid: productid,
    quantity: quantity
    },
    success: function (result) {
    addtocart();
    window.location.href = '@Url.ActionLink("checkout", "cart")';
    }
    })

    });
    $(document).on('click', '.remove-item', function (e) {
    var parent = $(this).parents('.item-cart-1');
    var id = parseInt(parent.attr('data-id'));
    $.ajax({
    type: 'POST',
    url: '@Url.ActionLink("RemoveCart", "Cart")',
    data: {
    productid: id,
    },
    success: function (result) {
    addtocart();
    }
    })
    });
    $(document).on('change', '.count', function () {
    var parent = $(this).parents('.item-cart-1');
    var id = parseInt(parent.attr('data-id'));
    var prev = parseInt(parent.find('input[name=qty]').data('val'));
    var value = parseInt($(this).val());

    if (value >= 1 && value < 11) {
    $.ajax({
    type: 'POST',
    url: '@Url.ActionLink("UpdateCart", "Cart")',
    data: {
    productid: id,
    quantity: value,
    },
    success: function (result) {
    addtocart();
    }
    });
    } else {
    alert("Số lượng tối thiểu là 1 và tối đa là 10")
    parent.find('input[name=qty]').val(prev);
    }
    })
    $(document).on('click', '.plus', function () {

    var parent = $(this).parents('.item-cart-1');
    var id = parseInt(parent.attr('data-id'));
    var value = parseInt(parent.find('.count').val());
    value++;
    if (value > 1 && value <= 10) {

    $.ajax({
    type: 'POST',
    url: '@Url.ActionLink("UpdateCart", "Cart")',
    data: {
    productid: id,
    quantity: value,
    },
    success: function (result) {
    addtocart();
    }
    });
    } else {
    alert("Không Quá 10 Sản Phẩm");
    }


    });
    $(document).on('click', '.minus', function () {
    var parent = $(this).parents('.item-cart-1');
    var id = parseInt(parent.attr('data-id'));
    var value = parseInt(parent.find('.count').val());
    if (value == 1) {
    $.ajax({
    type: 'POST',
    url: '@Url.ActionLink("RemoveCart", "Cart")',
    data: {
    productid: id,
    },
    success: function (result) {
    addtocart();
    }
    });
    } else {
    value--;
    $.ajax({
    type: 'POST',
    url: '@Url.ActionLink("UpdateCart", "Cart")',
    data: {
    productid: id,
    quantity: value,
    },
    success: function (result) {
    addtocart();
    }
    });
    }


    });
    $(".cart-togget").on("click", function (e) {

    $(".cart-content").toggleClass("fadein");

    });
    $(".close-cart i").on("click", function () {
    $(".cart-content").removeClass("fadein");
    });
    $('.js-add-cart').on('click', function () {
    var cart = $('#cart');

    var imgtodrag = $(this).parents('.product-grid6').find("img").eq(0);
    if (imgtodrag) {
    var imgclone = imgtodrag.clone()
    .offset({
    top: imgtodrag.offset().top,
    left: imgtodrag.offset().left
    })
    .css({
    'opacity': '0.5',
    'position': 'absolute',
    'height': '150px',
    'width': '150px',
    'z-index': '100'
    })
    .appendTo($('body'))
    .animate({
    'top': cart.offset().top + 10,
    'left': cart.offset().left + 10,
    'width': 50,
    'height': 50
    }, 1000, 'easeInOutExpo');

    setTimeout(function () {
    cart.effect("shake", {
    times: 2
    }, 200);
    }, 1500);

    imgclone.animate({
    'width': 0,
    'height': 0
    }, function () {
    $(this).detach()
    });
    setTimeout(function () { $('.cart-content').addClass('fadein') }, 2000);
    }

    });
    $('.add-cart').on('click', function () {
    var cart = $('#cart');
    var imgtodrag = $(this).parents('.product-details').prev(".gallery-lb").find("img").eq(0);
    if (imgtodrag) {
    var imgclone = imgtodrag.clone()
    .offset({
    top: imgtodrag.offset().top,
    left: imgtodrag.offset().left
    })
    .css({
    'opacity': '0.5',
    'position': 'absolute',
    'height': '150px',
    'width': '150px',
    'z-index': '100'
    })
    .appendTo($('body'))
    .animate({
    'top': cart.offset().top + 10,
    'left': cart.offset().left + 10,
    'width': 50,
    'height': 50
    }, 1000, 'easeInOutExpo');

    setTimeout(function () {
    cart.effect("shake", {
    times: 2
    }, 200);
    }, 1500);

    imgclone.animate({
    'width': 0,
    'height': 0
    }, function () {
    $(this).detach()
    });
    setTimeout(function () { $('.cart-content').addClass('fadein') }, 2000);
    }

    });
    $('.js-add-wishlist').on('click', function () {
    var cart = $('#wishlist-icon');
    var imgtodrag = $(this).parents('.product-grid6').find("img").eq(0);
    if (imgtodrag) {
    var imgclone = imgtodrag.clone()
    .offset({
    top: imgtodrag.offset().top,
    left: imgtodrag.offset().left
    })
    .css({
    'opacity': '0.5',
    'position': 'absolute',
    'height': '150px',
    'width': '150px',
    'z-index': '100'
    })
    .appendTo($('body'))
    .animate({
    'top': cart.offset().top + 10,
    'left': cart.offset().left + 10,
    'width': 50,
    'height': 50
    }, 1000, 'easeInOutExpo');

    setTimeout(function () {
    cart.effect("shake", {
    times: 2
    }, 200);
    }, 1500);

    imgclone.animate({
    'width': 0,
    'height': 0
    }, function () {
    $(this).detach()
    });
    }

    });
    $(document).on('click', '.js-add-wishlist', function (event) {
    event.preventDefault();
    let parent = $(this).parents('.product-item');
    let productid = parseInt(parent.find('.product-grid6').attr('data-id'));

    $.ajax({
    type: 'POST',
    url: '@Url.ActionLink("AddtoWishList", "Cart")',
    data: {
    productid: productid,
    },
    success: function (result) {
        addtowishlist();
    //window.location.href = '@Url.ActionLink("cart", "cart")';
    }
    })

    });
    function addtowishlist() {
    $.ajax({
    type: 'GET',
    url: '@Url.ActionLink("GetWishList", "Cart")',
    success: function (result) {
        var count = 0;
    if (result != null && result != '') {
    count = result.length;
    } else {
    $(".wishlist-count").html(`${0}`);
    return;
    }
    $(".wishlist-count").html(`${count}`);
    }
    })
                };
  $(document).on('click', '.remove-wishlish', function (e) {
      var parent = $(this).parents('.product-grid6');
        var id = parseInt(parent.attr('data-id'));
        $.ajax({
        type: 'POST',
        url: '@Url.ActionLink("RemoveWishList", "Cart")',
        data: {
        productid: id,
        },
            success: function (result) {
                addtowishlist();
               window.location.href = '@Url.ActionLink("wishlist", "cart")';
        }
        })
        });
    
        $(document).on('click', '.product-item', function (e) {
            var parent = $(this).children('.product-grid6');
        var id = parseInt(parent.attr('data-id'));
        $.ajax({
            type: 'POST',
            url: '@Url.ActionLink("RecentlyViewed", "Cart")',
            data: {
                productid: id,
            },
            success: function (result) {
                console.log("click vao");
            }
        });
        });
            });
 
</script>

    @RenderSection("Scripts", required: false)


</body>
</html>
