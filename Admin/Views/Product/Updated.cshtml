
@model FormProduct
@{
    ViewData["Title"] = "Updated";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles{
    <link href="~/lib/media-preview-upload/css/style.css" rel="stylesheet" />
}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">
            Cập nhật sản phẩm
        </h3>
        <p class="card-subtitle">@Model.Products.Title</p>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <form asp-action="Updated" method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <input type="hidden" asp-for="Products.Id" value="@Model.Products.Id" />
                    <div class="form-group">
                        <label asp-for="Products.Code" class="control-label"></label>
                        <input asp-for="Products.Code" class="form-control" value="@Model.Products.Code" />
                        <span asp-validation-for="Products.Code" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Products.Title" class="control-label"></label>
                        <input asp-for="Products.Title" class="form-control" value="@Model.Products.Title" />
                        <span asp-validation-for="Products.Title" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Products.Description" class="control-label"></label>
                        <input asp-for="Products.Description" class="form-control" value="@Model.Products.Description" />
                        <span asp-validation-for="Products.Description" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Products.Detail" class="control-label"></label>
                        <input asp-for="Products.Detail" class="form-control" value="@Model.Products.Detail" />
                        <span asp-validation-for="Products.Detail" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Products.CategoryId" class="control-label"></label>
                        <select asp-for="Products.CategoryId" class="form-control">
                            <option>Chọn</option>
                            @foreach (var item in Model.Products.categories)
                            {
                                <option value="@item.Id" selected="@(Model.Products.CategoryId == item.Id ? "selected" : "")">@item.Title</option>
                            }
                        </select>
                        <span asp-validation-for="Products.CategoryId" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Products.Price" class="control-label"></label>
                        <input asp-for="Products.Price" class="form-control" value="@Model.Products.Price" />
                        <span asp-validation-for="Products.Price" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Products.Sale" class="control-label"></label>
                        <input asp-for="Products.Sale" class="form-control" value="@Model.Products.Sale" />
                        <span asp-validation-for="Products.Sale" class="text-danger"></span>
                    </div>
                    <div class="form-group " >
                        <h3>Ảnh</h3>
                        <div class="media-list" id="meida">
                            <div>
                                <img src="~/user-content/@Model.Products.ThumbnailImageUrl" />
                                <div class="post-thumb">
                                    <div class="inner-post-thumb">
                                        <a href="javascript:void(0);" data-id="@Model.Products.ThumbnailImageUrl" class="remove-pic">
                                            <i class="fa fa-times" aria-hidden="true"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="myupload">
                                <span>
                                    <i class="fa fa-plus" aria-hidden="true" for="ThumbnailImage"></i>
                                    <input asp-for="ThumbnailImage" class="form-control-file " id="ThumbnailImage" type="file" name="ThumbnailImage" value="@Model.Products.ThumbnailImageUrl" />
                                </span>
                            </div>
                        </div>
                    
                        <span asp-validation-for="ThumbnailImage" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <h3>Danh sách hình ảnh</h3>
                        <ul class="media-list" id="media-list">
                            @foreach (var item in Model.Products.ProductImages)
                            {
                                <li>
                                    <img src="@item.MediaUrl" />
                                    <div class="post-thumb"><div class="inner-post-thumb"><a href="javascript:void(0);" data-id="@item.Media" class="remove-pic"><i class="fa fa-times" aria-hidden="true"></i></a><div></div></div></div>
                                </li>
                            }
                            <li class="myupload">
                                <span>
                                    <i class="fa fa-plus" aria-hidden="true" for="ProductImages"></i>
                                    <input asp-for="ProductImages" class="form-control-file " id="ProductImages" type="file" multiple name="ProductImages" />
                                </span>
                            </li>
                            <li>
                                <input  asp-for="@Model.Products.ProductImages" class="Delete" id="Delete" type="file" multiple/>
                                <span class="demo"> </span>
                            </li>
                          
                        </ul>
                        <span asp-validation-for="ProductImages" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <input type="submit" value="Save" class="btn btn-primary" />
                    </div>
                </form>
            </div>
        </div>

        <div>
            <a asp-action="Index">Back to List</a>
        </div>

    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            var names = @Html.Raw(Json.Serialize(Model.Products.ProductImages.Select(x => x.Media).ToList()));

            var ListDelete = [];

            $('body').on('change', '#ProductImages', function (event) {
                var files = event.target.files;
                for (var i = 0; i < files.length; i++) {
                    var file = files[i];
                    names.push($(this).get(0).files[i].name);
                    if (file.type.match('image')) {

                        var picReader = new FileReader();
                        picReader.fileName = file.name
                        picReader.addEventListener("load", function (event) {

                            var picFile = event.target;

                            var div = document.createElement("li");

                            div.innerHTML = "<img src='" + picFile.result + "'" +
                                "title='" + picFile.name + "'/><div  class='post-thumb'><div class='inner-post-thumb'><a href='javascript:void(0);' data-id='" + event.target.fileName + "' class='remove-pic'><i class='fa fa-times' aria-hidden='true'></i></a><div></div>";

                            $("#media-list").prepend(div);

                        });
                    } else {
                        var picReader = new FileReader();
                        picReader.fileName = file.name
                        picReader.addEventListener("load", function (event) {

                            var picFile = event.target;

                            var div = document.createElement("li");

                            div.innerHTML = "<video src='" + picFile.result + "'" +
                                "title='" + picFile.name + "'></video><div class='post-thumb'><div  class='inner-post-thumb'><a href='javascript:void(0);' data-id='" + event.target.fileName + "' class='remove-pic'><i class='fa fa-times' aria-hidden='true'></i></a><div></div>";

                            $("#media-list").prepend(div);

                        });
                    }
                    picReader.readAsDataURL(file);

                }

            });
            $('body').on('change', '#ThumbnailImage', function (event) {
                var file = event.target.files;
                var picReaders = new FileReader();
                picReaders.fileName = file[0].name;
                picReaders.addEventListener("load", function (event) {

                            var picFile = event.target;
                            console.log(picFile);

                            var div = document.createElement("div");
                    div.innerHTML = "<img src='" + picFile.result + "'" +
                        "title='" + picFile.name + "'/><div  class='post-thumb'><div class='inner-post-thumb'><a href='javascript:void(0);' data-id='" + event.target.fileName + "' class='remove-pic'><i class='fa fa-times' aria-hidden='true'></i></a><div></div>";
                    console.log(!$("#meida").find('div').first().hasClass('myupload'));
                    if (!$("#meida").find('div').first().hasClass('myupload')) {
                        $("#meida").find('div').first().remove();
                    }

                    $("#meida").prepend(div);

                        });
                picReaders.readAsDataURL(file[0]);


            });
            $('body').on('click', '.remove-pic', function () {
                $(this).parent().parent().parent().remove();
                var removeItem = $(this).attr('data-id');
                var yet = names.indexOf(removeItem);
                ListDelete.push(removeItem);
                var input = $('#Delete');
                input.files = ListDelete.toString();
                var demo = $('.demo').html(input.files);
                console.log(input);
                if (yet != -1) {
                    names.splice(yet, 1);
                }
             });
            });
            $('body').on('click', '.remove-pic', function () {
                $(this).parent().parent().parent().remove();
                var removeItem = $(this).attr('data-id');
                var yet = name.indexOf(removeItem);

                if (yet != -1) {
                    name.splice(yet, 1);
                }
            });

   

    </script>
    <script src="~/lib/media-preview-upload/js/app.js"></script>
  
}
